name: "ğŸš¦ CI - Petit Hong Kong (Lint âœ Format âœ Test âœ Build)"

on:
  push:
    branches: [ main, pipeline-github ]
  pull_request:
    branches: [ main ]

jobs:
  lint:
    name: "ğŸ” Lint (ESLint)"
    runs-on: ubuntu-latest
    steps:
      - name: "ğŸ“¥ Checkout code"
        uses: actions/checkout@v3

      - name: "ğŸŸ¢ Setup Node.js"
        uses: actions/setup-node@v3
        with:
          node-version: '20.x'
          cache: 'npm'

      - name: "ğŸ“¦ Install dependencies"
        run: npm ci

      - name: "ğŸ§¹ Run ESLint"
        run: npm run lint

  format:
    name: "ğŸ¨ Format (Prettier check)"
    runs-on: ubuntu-latest
    needs: lint
    steps:
      - name: "ğŸ“¥ Checkout code"
        uses: actions/checkout@v3

      - name: "ğŸŸ¢ Setup Node.js"
        uses: actions/setup-node@v3
        with:
          node-version: '20.x'
          cache: 'npm'

      - name: "ğŸ“¦ Install dependencies"
        run: npm ci

      - name: "ğŸ” Run Prettier check"
        run: npm run format:check

  test:
    name: "ğŸ§ª Tests"
    runs-on: ubuntu-latest
    needs: format
    steps:
      - name: "ğŸ“¥ Checkout code"
        uses: actions/checkout@v3

      - name: "ğŸŸ¢ Setup Node.js"
        uses: actions/setup-node@v3
        with:
          node-version: '20.x'
          cache: 'npm'

      - name: "ğŸ“¦ Install dependencies"
        run: npm ci

      - name: "ğŸ§ª Run tests"
        run: npm test

  build:
    name: "ğŸ› ï¸ Build"
    runs-on: ubuntu-latest
    needs: test
    steps:
      - name: "ğŸ“¥ Checkout code"
        uses: actions/checkout@v3

      - name: "ğŸŸ¢ Setup Node.js"
        uses: actions/setup-node@v3
        with:
          node-version: '20.x'
          cache: 'npm'

      - name: "ğŸ“¦ Install dependencies"
        run: npm ci

      - name: "ğŸ› ï¸ Build the app"
        run: npm run build
